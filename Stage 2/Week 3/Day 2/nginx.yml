- become: true
  gather_facts: false
  hosts: gateway
  tasks:
  # Install NGINX
  - name: "NGINX Config"
    copy:
      dest: "/tmp/dumbways.conf"
      content: |
        # Generated by $(certbot --nginx)
  # Deploy Frontend
  - name: "Install NGINX and Deploy Wayshub"
    community.docker.docker_compose:
      project_name: wayshub
      definition:
        version: '2'
        services:
          # NGINX
          gateway:
            image: nginx
            ports:
              - 80:80
              - 443:443
            volumes:
              - /tmp/dumbways.conf:/etc/nginx/conf.d/dumbways.conf
              - /etc/letsencrypt:/etc/letsencrypt:ro
          # Wayshub
          frontend:
            image: dioput12/wayshub-frontend
            ports:
              - 3000:3000
            depends_on:
              - gateway
      state: present
    register: output
